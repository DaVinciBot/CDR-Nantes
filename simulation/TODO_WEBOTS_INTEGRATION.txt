================================================================================
TODO SYNTH√àSE - INT√âGRATION WEBOTS CDR-NANTES
================================================================================
üéØ Plan d'action en 9 √©tapes

√âtat actuel : 6/9 √©tapes compl√©t√©es
Derni√®re mise √† jour : 11 janvier 2026


================================================================================
‚úÖ √âTAPE 1 : Cr√©er fake_stepper_FIXED.cpp (2h) - TERMIN√â
================================================================================
Objectif : Impl√©menter l'interface stepper.h de KaribouMotion pour Webots

Actions r√©alis√©es :
 ‚úÖ Cr√©√© simulation/controllers/teensy_controller/fake_stepper.cpp
 ‚úÖ Utilise std::map<Stepper*, WebotsMotorData> pour stocker les tags Webots
 ‚úÖ Impl√©ment√© TOUTES les m√©thodes de stepper.h (compute, step, setMaxSpeed, etc.)
 ‚úÖ Constructeur r√©cup√®re motor1/2/3 et encoder1/2/3 via wb_robot_get_device()
 ‚úÖ step() adapt√© pour envoyer vitesses √† Webots
 ‚úÖ Profils trap√©zo√Ødaux, synchronisation, calculs pr√©serv√©s

Test de validation :
 ‚úÖ Compilation sans erreur
 ‚úÖ Moteurs d√©tect√©s (motor1, motor2, motor3)
 ‚úÖ Encodeurs d√©tect√©s (encoder1, encoder2, encoder3)


================================================================================
‚úÖ √âTAPE 2 : Corriger ArduinoFake.h (30min) - TERMIN√â
================================================================================
Objectif : Corriger les bugs de timing et port s√©rie

Actions r√©alis√©es :
 ‚úÖ millis() et micros() utilisent wb_robot_get_time()
 ‚úÖ SerialMock avec API Windows (CreateFile, ReadFile, WriteFile)
 ‚úÖ Logs de debug ajout√©s
 ‚ö†Ô∏è  Port s√©rie actuellement COM2 (√† changer en COM8 pour com0com)

Test de validation :
 ‚úÖ Recompil√© sans erreur
 ‚úÖ Logs au lancement : "[Webots] INFO: Pas de COM2. Mode simulation hors ligne."

√Ä FAIRE pour finaliser :
 [ ] Modifier ArduinoFake.h ligne 86 : "\\\\.\\COM2" ‚Üí "\\\\.\\COM8"


================================================================================
‚ùå √âTAPE 3 : Installer com0com (15min) - √Ä FAIRE
================================================================================
Objectif : Cr√©er les ports s√©rie virtuels Windows

Actions √† effectuer :
 [ ] T√©l√©charger com0com depuis SourceForge
 [ ] Installer en mode administrateur
 [ ] Ouvrir "Setup Command Prompt"
 [ ] Ex√©cuter : install PortName=COM8 PortName=COM9
 [ ] V√©rifier : list

Test de validation :
 [ ] Cr√©er script Python test_serial_echo.py
 [ ] √âcrire sur COM9, lire sur COM8
 [ ] V√©rifier que les donn√©es transitent


================================================================================
‚úÖ √âTAPE 4 : Adapter teensy_controller.cpp (1h) - TERMIN√â (variante)
================================================================================
Objectif : √âmuler les 2 timers du vrai code dans la boucle Webots

Actions r√©alis√©es :
 ‚úÖ Structure identique au vrai main.cpp du Teensy
 ‚úÖ Initialisation : wb_robot_init(), Serial, Com, holonomic_basis
 ‚úÖ Boucle principale avec wb_robot_step(time_step)
 ‚úÖ Appels : com->handle_callback(), handle(), execute_movement()
 ‚ö†Ô∏è  Variante : boucle unique au lieu de double timer 10ms/100ms

Test de validation :
 ‚úÖ Compilation OK
 ‚úÖ Simulation tourne
 ‚ö†Ô∏è  Mouvement incorrect (probl√®me cin√©matique/g√©om√©trie √† r√©gler)


================================================================================
‚úÖ √âTAPE 5 : Modifier le Makefile (10min) - TERMIN√â
================================================================================
Objectif : Configurer la compilation avec les bonnes sources

Actions r√©alis√©es :
 ‚úÖ CXX_SOURCES : teensy_controller.cpp fake_stepper.cpp ArduinoFake.cpp
 ‚úÖ Sources projet ajout√©es : com.cpp, crc.cpp, holonomic_basis.cpp, pid.cpp
 ‚úÖ Tous les includes configur√©s
 ‚úÖ -include "ArduinoFake.h" dans CFLAGS pour teensy_controller.o

Test de validation :
 ‚úÖ make clean && make
 ‚úÖ Compilation compl√®te sans erreur
 ‚úÖ Ex√©cutable teensy_controller.exe g√©n√©r√©


================================================================================
‚ùì √âTAPE 6 : Nettoyer le monde Webots (30min) - STATUT INCONNU
================================================================================
Objectif : Garder un seul robot correctement configur√©

Actions √† v√©rifier :
 [ ] Ouvrir simulation/worlds/my_world.wbt
 [ ] V√©rifier qu'il n'y a qu'un seul robot
 [ ] V√©rifier que controller = "teensy_controller"
 [ ] V√©rifier maxVelocity des 3 moteurs
 ‚úÖ Noms confirm√©s : motor1, motor2, motor3 et encoder1, encoder2, encoder3

Test de validation :
 ‚úÖ 1 robot visible dans Webots
 ‚úÖ Console affiche "‚úÖ Moteur 'motor1' initialis√©" x3
 ‚úÖ Aucune erreur "Device not found"


================================================================================
‚ùå √âTAPE 7 : Script Python de test (30min) - PAS FAIT
================================================================================
Objectif : Cr√©er un script pour contr√¥ler le robot depuis Python

Actions √† effectuer :
 [ ] Cr√©er simulation/test_webots_simple.py
 [ ] Importer loader et classes Com/Messages
 [ ] Court-circuiter d√©tection USB : com._device = serial.Serial('COM8', 115200)
 [ ] Ajouter callback pour UPDATE_ROLLING_BASIS
 [ ] Tests √† impl√©menter :
     - Reset odom√©trie (0, 0, 0)
     - Avancer 200mm (200, 0, 0)
     - Strafe 200mm (200, 200, 0)
     - Rotation 90¬∞ (200, 200, 1.5708)

Test de validation :
 [ ] Terminal 1 : Lancer Webots
 [ ] Terminal 2 : python simulation/test_webots_simple.py
 [ ] Le robot doit bouger dans Webots


================================================================================
üîÑ √âTAPE 8 : Validation compl√®te (1h) - EN COURS
================================================================================
Tests fonctionnels √† effectuer :

Test 1 : Translation X
 [ ] Commande : (100, 0, 0)
 [ ] V√©rifier : Robot avance droit
 [ ] V√©rifier : Roue 3 (arri√®re) tourne le plus

Test 2 : Translation Y
 [ ] Commande : (0, 100, 0)
 [ ] V√©rifier : Robot glisse lat√©ralement (strafe)
 [ ] V√©rifier : Roues avant tournent en sens oppos√©

Test 3 : Rotation pure
 [ ] Commande : (0, 0, 1.57)
 [ ] V√©rifier : Robot tourne sur place
 [ ] V√©rifier : Les 3 roues tournent dans le m√™me sens

Test 4 : Synchronisation
 [ ] Commande : (300, 300, 0)
 [ ] V√©rifier : Les 3 moteurs s'arr√™tent simultan√©ment
 [ ] Observer : Pas de roue qui arrive avant les autres

Test 5 : PID
 [ ] Commande : (500, 0, 0)
 [ ] V√©rifier : Pas d'oscillations
 [ ] V√©rifier : Converge en < 5s
 [ ] V√©rifier : Erreur finale < 10mm

Checklist de validation finale :
 ‚úÖ Compilation sans erreur
 ‚ö†Ô∏è  Connexion s√©rie fonctionnelle (actuellement mode hors ligne)
 [ ] Messages Python ‚Üí Webots (le robot bouge)
 [ ] Messages Webots ‚Üí Python (positions affich√©es)
 ‚ö†Ô∏è  Cin√©matique correcte (actuellement incorrect - √©quations √† ajuster)
 [ ] Synchronisation des 3 moteurs OK
 [ ] PID stable (pas d'oscillations infinies)
 ‚úÖ Code Teensy dans robot1/teensy_moteur/ INCHANG√â


================================================================================
‚ùå √âTAPE 9 : Documentation et tuning PID (optionnel) - PAS FAIT
================================================================================
Objectif : Pr√©parer le passage au robot r√©el

Actions √† effectuer :
 [ ] Cr√©er simulation/README.md avec instructions d'installation
 [ ] Documenter les diff√©rences simulation vs r√©el
 [ ] Sauvegarder les gains PID simulation dans un fichier d√©di√©
 [ ] Pr√©parer gains PID r√©el (diviser par 2 les valeurs simulation)
 [ ] (Optionnel) Cr√©er script de plot pour tracer courbes PID
 [ ] Ajouter .gitignore pour exclure binaires et fichiers locaux

Documentation minimale √† cr√©er :
 [ ] Instructions installation (com0com, Webots)
 [ ] Proc√©dure de lancement
 [ ] Troubleshooting des probl√®mes fr√©quents
 [ ] Diff√©rences simulation/r√©el


================================================================================
üìù NOTES IMPORTANTES
================================================================================

Fichiers √† NE PAS modifier (code robot r√©el) :
 - robot1/teensy_moteur/**  (tout le dossier)
 - common/usb_com/**  (sauf pour tests)

Fichiers de simulation (modifiables) :
 - simulation/controllers/teensy_controller/fake_stepper.cpp
 - simulation/controllers/teensy_controller/Arduino.h
 - simulation/controllers/teensy_controller/ArduinoFake.h
 - simulation/controllers/teensy_controller/ArduinoFake.cpp
 - simulation/controllers/teensy_controller/teensy_controller.cpp
 - simulation/controllers/teensy_controller/Makefile
 - simulation/worlds/my_world.wbt

Probl√®mes connus :
 - Mouvement incorrect : probablement angles roues ou ROBOT_RADIUS dans holonomic_basis
 - COM2 √† changer en COM8/COM9 pour com0com
 - Timer double (10ms/100ms) non impl√©ment√© (boucle unique √† la place)


================================================================================
üéØ PROCHAINES ACTIONS RECOMMAND√âES
================================================================================

Option A - Communication s√©rie (√âtapes 3 + 7) :
 1. Installer com0com (COM8 ‚Üî COM9)
 2. Modifier ArduinoFake.h ligne 86 : COM2 ‚Üí COM8
 3. Cr√©er test_webots_simple.py
 4. Tester commandes Python ‚Üí Webots

Option B - Corriger cin√©matique (√âtape 8) :
 1. V√©rifier angles des roues dans holonomic_basis
 2. Ajuster ROBOT_RADIUS / WHEEL_DIAMETER dans config.h
 3. V√©rifier conversion steps ‚Üî radians dans fake_stepper.cpp
 4. Tester mouvements basiques (avancer, strafe, rotation)


================================================================================
FIN TODO LIST
================================================================================
